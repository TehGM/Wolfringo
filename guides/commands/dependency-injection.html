<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Dependency Injection | Wolfringo Documentation </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Dependency Injection | Wolfringo Documentation ">
    <meta name="generator" content="docfx 2.59.4.0">
    
    <link rel="shortcut icon" href="../../wolfringo_logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/night-owl.min.css">
    <link rel="stylesheet" href="../../styles/colors.css">
    <link rel="stylesheet" href="../../styles/discord.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    
    
  </head>

  <body>
        <div class="top-navbar">

            <a href="javascript:void(0);" class="burger-icon" onclick="toggleMenu()">
                <svg name="Hamburger" style="vertical-align: middle;" width="24" height="24" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M20 6H4V9H20V6ZM4 10.999H20V13.999H4V10.999ZM4 15.999H20V18.999H4V15.999Z"></path></svg>
            </a>

            
            <a class="brand" href="../../index.html">
              <img src="../../wolfringo_logo.png" alt="Wolfringo" class="logomark">
              <span class="brand-title">Wolfringo</span>
            </a>
        </div>

        <div class="body-content">

            <div id="blackout" class="blackout" onclick="toggleMenu()"></div>

            <nav id="sidebar" role="navigation">

                <div class="sidebar">
                    
                    
                    
                    
                    <div>
                      
                      <a class="brand" href="../../index.html">
                        <img src="../../wolfringo_logo.png" alt="Wolfringo" class="logomark">
                        <span class="brand-title">Wolfringo</span>
                      </a>
                      <div id="navbar">
                    
                      </div>
                    
                    </div>
                    

                    <div class="sidebar-item-separator"></div>

                        
                        <div id="sidetoggle">
                          <div id="sidetoc"></div>
                        </div>

                </div>

                <div class="footer">
                  Wolfringo (c) 2020 <a href='https://tehgm.net'>TehGM</a><br>DocFX, <a href='https://github.com/jbltx/DiscordFX/'>DiscordFX</a> theme.
                  
                </div>
            </nav>

            <main class="main-panel">

                <div>
                  
                  <div id="search-results">
                    <div class="search-list">Search Results for <span></span></div>
                    <div class="sr-items">
                      <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
                    </div>
                    <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
                  </div>
                </div>

                <div role="main" class="hide-when-search">

                        
                        <div class="subnav navbar navbar-default">
                          <div class="container hide-when-search" id="breadcrumb">
                            <ul class="breadcrumb">
                              <li></li>
                            </ul>
                          </div>
                        </div>

                    <article class="content wrap" id="_content" data-uid="Guides.Commands.DependencyInjection">
<h1 id="dependency-injection-in-commands-system">Dependency Injection in Commands System</h1>

<p>Wolfringo is built entirely with Dependency Injection in mind, and Commands System is no exception. In fact, Commands System makes even more use of it than the rest of Wolfringo library.</p>
<p>Dependency Injection is a mechanism for sharing services and other dependencies with other classes by providing (injecting) these dependencies into them. Dependency Injection is the recommended way to share instances of classes (such as instance of current <a class="xref" href="../../api/TehGM.Wolfringo.IWolfClient.html">IWolfClient</a>, your database class, or any other service your bot needs to work). Using static variables/properties would work as well, but it would greatly reduce maintainability, testability and quality of the project.</p>
<p>In Wolfringo Commands System, Handlers constructors, commands methods, internal commands instances, and even <a class="xref" href="commands-requirements.html#custom-requirements">Commands Requirements</a> all support injection of services via Dependency Injection.</p>
<h4 id="handler-constructor-dependency-injection">Handler Constructor Dependency Injection</h4>
<p>To inject dependencies into handler constructor, simply specify them as its parameters.</p>
<pre><code class="lang-csharp">private readonly IWolfClient _client;
private readonly IMySuperDatabase _database;

public ExampleCommandsHandler(IWolfClient client, IMySuperDatabase database)
{
    this._client = client;
    this._database = database;
}
</code></pre>
<p>If Commands System cannot resolve required dependencies for any of the available constructors, it'll log error and commands in that handler won't work. Check <a class="xref" href="dependency-injection.html#registering-services">Registering Services</a> to check how to add services to DI - for example your custom <em>IMySuperDatabase</em>.<br>
You can also mark services as optional by giving the parameter a default value. Commands Service will still try to resolve the dependency, but if it fails to do so, it'll simply use the default value instead of throwing errors.</p>
<h4 id="command-method-dependency-injection">Command Method Dependency Injection</h4>
<p>Command methods support dependency injection in a similar manner as <a class="xref" href="dependency-injection.html#handler-constructor-dependency-injection">Handler Constructors</a> - simply specify them as the parameters.</p>
<pre><code class="lang-csharp">[Command(&quot;example&quot;)]
private async Task ExampleAsync(ICommandContext context, IWolfClient client, IMySuperDatabase database)
{
    // do something with client and database here!
}
</code></pre>
<p>If Commands System cannot resolve a required dependency of any of the parameters, it'll log an error and abort executing the command. Check <a class="xref" href="dependency-injection.html#registering-services">Registering Services</a> to check how to add services to DI - for example your custom <em>IMySuperDatabase</em>.<br>
You can also mark services as optional by giving the parameter a default value. Commands Service will still try to resolve the dependency, but if it fails to do so, it'll simply use the default value instead of throwing errors.</p>
<h4 id="command-requirement-dependency-injection">Command Requirement Dependency Injection</h4>
<p>Command Requirement's <a class="xref" href="../../api/TehGM.Wolfringo.Commands.ICommandRequirement.html#TehGM_Wolfringo_Commands_ICommandRequirement_CheckAsync_TehGM_Wolfringo_Commands_ICommandContext_System_IServiceProvider_System_Threading_CancellationToken_">CheckAsync</a> method has @System.IServiceProvider as one of its parameters. Whenever <a class="xref" href="../../api/TehGM.Wolfringo.Commands.CommandsService.html">CommandsService</a> runs checks, its services will be provided via this parameter. You can use it to gain access to your own services - for example your custom <em>IMySuperDatabase</em>.</p>
<p>See <a class="xref" href="commands-requirements.html#custom-requirements">Creating Custom Command Requirements guide</a> for more information.</p>
<h2 id="registering-services">Registering Services</h2>
<p>Registration of Dependency Injection services varies slightly depending whether you use Wolfringo.Hosting or not.</p>
<div class="tabGroup" id="tabgroup_bHGHmlrG6S">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_bHGHmlrG6S_connecting-normal-bot" role="tab" aria-controls="tabpanel_bHGHmlrG6S_connecting-normal-bot" data-tab="connecting-normal-bot" tabindex="0" aria-selected="true">Without Wolfringo.Hosting (Normal Bot)</a>
</li>
<li role="presentation">
<a href="#tabpanel_bHGHmlrG6S_connecting-hosted-bot" role="tab" aria-controls="tabpanel_bHGHmlrG6S_connecting-hosted-bot" data-tab="connecting-hosted-bot" tabindex="-1">With Wolfringo.Hosting (.NET Generic Host/ASP.NET Core)</a>
</li>
</ul>
<section id="tabpanel_bHGHmlrG6S_connecting-normal-bot" role="tabpanel" data-tab="connecting-normal-bot">

<p>Since Wolfringo v2.0, adding services is a matter of calling <code>WithSingletonService</code>, <code>WithScopedService</code> or <code>WithTransientService</code> on <a class="xref" href="../../api/TehGM.Wolfringo.Commands.CommandsServiceBuilder.html">CommandsServiceBuilder</a>. See <a href="#services-lifetime">Services Lifetime</a> to understand the difference between these methods.</p>
<pre><code class="lang-csharp">// in your MainAsync method:
_client = new WolfClientBuilder()
    .WithCommands(commands =&gt;
    {
        commands.WithSingletonService&lt;IMySuperDatabase, MySuperDatabase&gt;();
    })
    .Build();
</code></pre>
<p>You can add as many custom services as you want, as long as their resolving types (in example above - <em>IMySuperDatabase</em>) are different.</p>
<div class="NOTE">
<h5>Note</h5>
<p>Note: services registered with <a class="xref" href="../../api/TehGM.Wolfringo.Commands.CommandsServiceBuilder.html">CommandsServiceBuilder</a> are NOT available to WolfClient, which might be important if you're <a class="xref" href="../customizing/introduction.html">customizing Wolfringo</a>.
<a class="xref" href="../../api/TehGM.Wolfringo.WolfClientBuilder.html">WolfClientBuilder</a> also has a <code>WithService</code> method. All services added with this method will be available to both WolfClient and Commands (unless they're created separately), however they will always be registered with <em><strong>Singleton</strong></em> lifetime.</p>
</div>
<div class="WARNING">
<h5>Warning</h5>
<p>Please note that both <a class="xref" href="../../api/TehGM.Wolfringo.Commands.CommandsServiceBuilder.html">CommandsServiceBuilder</a> and <a class="xref" href="../../api/TehGM.Wolfringo.WolfClientBuilder.html">WolfClientBuilder</a> build their @System.IServiceProvider separately. That means both will get DIFFERENT copies of the same service.<br>
Note: this is not applicable to Wolfringo.Hosting - in that scenario, both WolfClient and CommandsService use the same, host-provided @System.IServiceProvider.</p>
</div>
</section>
<section id="tabpanel_bHGHmlrG6S_connecting-hosted-bot" role="tabpanel" data-tab="connecting-hosted-bot" aria-hidden="true" hidden="hidden">

<p><a href="https://docs.microsoft.com/en-gb/aspnet/core/fundamentals/host/generic-host?view=aspnetcore-3.0">.NET Generic Host</a>/<a href="https://docs.microsoft.com/en-gb/aspnet/core/fundamentals/host/web-host?view=aspnetcore-3.0">ASP.NET Core</a> have Dependency Injection deeply baked into them, and as such, they support it out of the box.<br>
<a class="xref" href="../../api/TehGM.Wolfringo.Hosting.HostedWolfClient.html">HostedWolfClient</a> will automatically pick up any services that you register in your ConfigureServices method. You don't need to do anything else - these services will be automatically used by Wolfringo.</p>
<p>Refer to <a href="https://docs.microsoft.com/en-us/dotnet/core/extensions/dependency-injection">Dependency injection in .NET</a> and <a href="https://docs.microsoft.com/en-gb/aspnet/core/fundamentals/dependency-injection?view=aspnetcore-3.0">Dependency injection in ASP.NET Core</a> for more information about Dependency Injection in <a href="https://docs.microsoft.com/en-gb/aspnet/core/fundamentals/host/generic-host?view=aspnetcore-3.0">.NET Generic Host</a>/<a href="https://docs.microsoft.com/en-gb/aspnet/core/fundamentals/host/web-host?view=aspnetcore-3.0">ASP.NET Core</a>.</p>
</section>
</div>
<h2 id="services-lifetime">Services Lifetime</h2>
<p>Services can have following lifetimes:</p>
<ul>
<li>Singleton (<code>AddSingletonService&lt;T&gt;()</code>) - this service is created once, and kept alive until application exits.</li>
<li>Scoped (<code>AddScopedService&lt;T&gt;()</code>) - this service is created once for a received message. Each new message will get a new copy of this service.</li>
<li>Scoped (<code>AddTransientService&lt;T&gt;()</code>) - this service is created once per injection. If the service is used in constructor, method, requirement, or any combination of them, each will receive a new copy.</li>
</ul>
<p>It is likely that you'll mostly use singleton services.</p>
</article>
              
                </div>
            </main>
        </div>

        
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script>
<script type="text/javascript" src="../../styles/jquery.twbsPagination.js"></script>
<script type="text/javascript" src="../../styles/url.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script>
<script type="text/javascript" src="../../styles/docfx.js"></script>
<script type="text/javascript" src="../../styles/main.js"></script>
<script type="text/javascript">
	anchors.options.visible = 'touch';
	anchors.options.placement = 'left';
	anchors.add('h2, h3, h4, h5');
</script>
    </body>

</html>
