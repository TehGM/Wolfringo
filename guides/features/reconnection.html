<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Auto-Reconnecting | Wolfringo Documentation </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Auto-Reconnecting | Wolfringo Documentation ">
    <meta name="generator" content="docfx 2.59.4.0">
    
    <link rel="shortcut icon" href="../../wolfringo_logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/night-owl.min.css">
    <link rel="stylesheet" href="../../styles/colors.css">
    <link rel="stylesheet" href="../../styles/discord.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    
    
  </head>

  <body>
        <div class="top-navbar">

            <a href="javascript:void(0);" class="burger-icon" onclick="toggleMenu()">
                <svg name="Hamburger" style="vertical-align: middle;" width="24" height="24" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M20 6H4V9H20V6ZM4 10.999H20V13.999H4V10.999ZM4 15.999H20V18.999H4V15.999Z"></path></svg>
            </a>

            
            <a class="brand" href="../../index.html">
              <img src="../../wolfringo_logo.png" alt="Wolfringo" class="logomark">
              <span class="brand-title">Wolfringo</span>
            </a>
        </div>

        <div class="body-content">

            <div id="blackout" class="blackout" onclick="toggleMenu()"></div>

            <nav id="sidebar" role="navigation">

                <div class="sidebar">
                    
                    
                    
                    
                    <div>
                      
                      <a class="brand" href="../../index.html">
                        <img src="../../wolfringo_logo.png" alt="Wolfringo" class="logomark">
                        <span class="brand-title">Wolfringo</span>
                      </a>
                      <div id="navbar">
                    
                      </div>
                    
                    </div>
                    

                    <div class="sidebar-item-separator"></div>

                        
                        <div id="sidetoggle">
                          <div id="sidetoc"></div>
                        </div>

                </div>

                <div class="footer">
                  Wolfringo (c) 2020 <a href='https://tehgm.net'>TehGM</a><br>DocFX, <a href='https://github.com/jbltx/DiscordFX/'>DiscordFX</a> theme.
                  
                </div>
            </nav>

            <main class="main-panel">

                <div>
                  
                  <div id="search-results">
                    <div class="search-list">Search Results for <span></span></div>
                    <div class="sr-items">
                      <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
                    </div>
                    <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
                  </div>
                </div>

                <div role="main" class="hide-when-search">

                        
                        <div class="subnav navbar navbar-default">
                          <div class="container hide-when-search" id="breadcrumb">
                            <ul class="breadcrumb">
                              <li></li>
                            </ul>
                          </div>
                        </div>

                    <article class="content wrap" id="_content" data-uid="Guides.Features.Reconnection">
<h1 id="auto-reconnecting">Auto-Reconnecting</h1>

<p>When it comes to networking, disconnection can happen at any moment. Additionally, WOLF server force disconnects after an hour of a connection.</p>
<p>To address this, Wolfringo offers some built-in reconnection solutions.</p>
<div class="tabGroup" id="tabgroup_bHGHmlrG6S">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_bHGHmlrG6S_reconnecting-normal-bot" role="tab" aria-controls="tabpanel_bHGHmlrG6S_reconnecting-normal-bot" data-tab="reconnecting-normal-bot" tabindex="0" aria-selected="true">Without Wolfringo.Hosting (Normal Bot)</a>
</li>
<li role="presentation">
<a href="#tabpanel_bHGHmlrG6S_reconnecting-hosted-bot" role="tab" aria-controls="tabpanel_bHGHmlrG6S_reconnecting-hosted-bot" data-tab="reconnecting-hosted-bot" tabindex="-1">With Wolfringo.Hosting (.NET Generic Host/ASP.NET Core)</a>
</li>
</ul>
<section id="tabpanel_bHGHmlrG6S_reconnecting-normal-bot" role="tabpanel" data-tab="reconnecting-normal-bot">
<h3 id="enabling-auto-connection">Enabling auto-connection</h3>
<p>Auto-reconnection without Wolfringo.Hosting needs to be enabled manually. <a class="xref" href="../../api/TehGM.Wolfringo.WolfClient.html">WolfClient</a> does not automatically reconnect on its own.<br>
<a href="https://www.nuget.org/packages/Wolfringo.Utilities">Wolfringo.Utilities</a> (installed by <a href="https://www.nuget.org/packages/Wolfringo">Wolfringo</a> metapackage automatically) includes <a class="xref" href="../../api/TehGM.Wolfringo.Utilities.WolfClientReconnector.html">WolfClientReconnector</a> helper class that can be used for easy auto-reconnection.</p>
<p><a class="xref" href="../../api/TehGM.Wolfringo.Utilities.WolfClientReconnector.html">WolfClientReconnector</a> is a separate class to adhere to SOLID principles, and to make its reconnection logic independent on implementation of <a class="xref" href="../../api/TehGM.Wolfringo.IWolfClient.html">IWolfClient</a>. Its constructor takes a <a class="xref" href="../../api/TehGM.Wolfringo.IWolfClient.html">IWolfClient</a> that it'll handle reconnection for, and it'll listen to <a class="xref" href="../../api/TehGM.Wolfringo.IWolfClient.html#TehGM_Wolfringo_IWolfClient_Disconnected">Disconnected</a> event. Once disconnection happens, it'll trigger a reconnection.</p>
<p>To use it, create instance of <a class="xref" href="../../api/TehGM.Wolfringo.Utilities.ReconnectorConfig.html">ReconnectorConfig</a>, and create a new instance of <a class="xref" href="../../api/TehGM.Wolfringo.Utilities.WolfClientReconnector.html">WolfClientReconnector</a> using these options and instance of your <a class="xref" href="../../api/TehGM.Wolfringo.IWolfClient.html">IWolfClient</a>.</p>
<pre><code class="lang-csharp">_client = new WolfClientBuilder()    
    .WithAutoReconnection(reconnector =&gt;
    {
        // ... configure reconnector here ...
    })
    .Build();
</code></pre>
<p>If you wish, you can also create reconnector separately - this way you can <a href="#auto-reconnection-errors">handle its errors</a>, or manually <a href="#disabling-auto-reconnection">disable it</a>.</p>
<pre><code class="lang-csharp">_client = new WolfClientBuilder().Build();
ReconnectorConfig options = new ReconnectorConfig();
WolfClientReconnector reconnector = new WolfClientReconnector(_client, options);
// do something with reconnector
</code></pre>
<div class="WARNING">
<h5>Warning</h5>
<p>Do <strong>NOT</strong> use <a class="xref" href="../../api/TehGM.Wolfringo.Utilities.WolfClientReconnector.html">WolfClientReconnector</a> with Wolfringo.Hosting!</p>
</div>
<h3 id="configuring-auto-reconnection">Configuring auto-reconnection</h3>
<p><a class="xref" href="../../api/TehGM.Wolfringo.Utilities.ReconnectorConfig.html">ReconnectorConfig</a> class has a few properties which can be used to customize reconnection behaviour:</p>
<ul>
<li><a class="xref" href="../../api/TehGM.Wolfringo.Utilities.ReconnectorConfig.html#TehGM_Wolfringo_Utilities_ReconnectorConfig_ReconnectAttempts">ReconnectAttempts</a> - number of reconnection attempts to make. If set to 0, reconnection will be disabled. If set to negative number, infinite amount of attempts will be made. <em>Defaults to 5</em>.</li>
<li><a class="xref" href="../../api/TehGM.Wolfringo.Utilities.ReconnectorConfig.html#TehGM_Wolfringo_Utilities_ReconnectorConfig_ReconnectionDelay">ReconnectionDelay</a> - a @System.TimeSpan that will be waited between reconnection attempts. 0 or negative values disable the wait time. <em>Defaults to half second</em>.</li>
<li><a class="xref" href="../../api/TehGM.Wolfringo.Utilities.ReconnectorConfig.html#TehGM_Wolfringo_Utilities_ReconnectorConfig_Log">Log</a> - an @Microsoft.Extensions.Logging.ILogger to log any messages with. See <a class="xref" href="logging.html">Logging guide</a> for more info. If null, logging will be disabled. Using with <code>WolfClientBuilder.WithAutoReconnection</code> will make it automatically use configured logging. <em>Defaults to null</em>.</li>
<li><a class="xref" href="../../api/TehGM.Wolfringo.Utilities.ReconnectorConfig.html#TehGM_Wolfringo_Utilities_ReconnectorConfig_CancellationToken">CancellationToken</a> - a @System.Threading.CancellationToken that will cancel any reconnections.</li>
</ul>
<h3 id="auto-reconnection-errors">Auto-reconnection errors</h3>
<p>If <a class="xref" href="../../api/TehGM.Wolfringo.Utilities.ReconnectorConfig.html#TehGM_Wolfringo_Utilities_ReconnectorConfig_Log">Log</a> property of <a class="xref" href="../../api/TehGM.Wolfringo.Utilities.ReconnectorConfig.html">ReconnectorConfig</a> is not null, all error messages will be logged using that @Microsoft.Extensions.Logging.ILogger.</p>
<p>If reconnector makes <a class="xref" href="../../api/TehGM.Wolfringo.Utilities.ReconnectorConfig.html#TehGM_Wolfringo_Utilities_ReconnectorConfig_ReconnectAttempts">ReconnectorConfig.ReconnectAttempts</a> to reconnect and each attempt fails, the reconnector will invoke <a class="xref" href="../../api/TehGM.Wolfringo.Utilities.WolfClientReconnector.html#TehGM_Wolfringo_Utilities_WolfClientReconnector_FailedToReconnect">FailedToReconnect</a> event - you can listen to that event to handle reconnection failed in your code. <a class="xref" href="../../api/TehGM.Wolfringo.Utilities.WolfClientReconnector.html#TehGM_Wolfringo_Utilities_WolfClientReconnector_FailedToReconnect">FailedToReconnect</a> event provides @System.UnhandledExceptionEventArgs, which in turn has @System.UnhandledExceptionEventArgs.ExceptionObject. This object will be set to an @System.AggregateException, which contains all exceptions that occured when trying to reconnect. See <a href="https://docs.microsoft.com/en-gb/dotnet/api/system.aggregateexception?view=netcore-3.0">Microsoft docs</a> to see how to handle that exception.</p>
<div class="WARNING">
<h5>Warning</h5>
<p>If <a class="xref" href="../../api/TehGM.Wolfringo.Utilities.ReconnectorConfig.html#TehGM_Wolfringo_Utilities_ReconnectorConfig_ReconnectAttempts">ReconnectAttempts</a> are set to infinite (negative value), no error event will be raised!</p>
</div>
<h3 id="disabling-auto-reconnection">Disabling auto-reconnection</h3>
<p><a class="xref" href="../../api/TehGM.Wolfringo.Utilities.WolfClientReconnector.html">WolfClientReconnector</a> will attempt to reconnect no matter what was the cause of disconnection. If you want to disable this behaviour, simply call <a class="xref" href="../../api/TehGM.Wolfringo.Utilities.WolfClientReconnector.html#TehGM_Wolfringo_Utilities_WolfClientReconnector_Dispose">Dispose()</a>. Once disposed, reconnector will be disabled permanently - to re-enable, create a new <a class="xref" href="../../api/TehGM.Wolfringo.Utilities.WolfClientReconnector.html">WolfClientReconnector</a> instance.</p>
<div class="TIP">
<h5>Tip</h5>
<p>If <a class="xref" href="../../api/TehGM.Wolfringo.Utilities.WolfClientReconnector.html">WolfClientReconnector</a> is not good enough for your needs, you can create your own reconnection with your own logic. See <a href="https://github.com/TehGM/Wolfringo/blob/master/Wolfringo.Utilities/WolfClientReconnector.cs">WolfClientReconnector source code</a> if you need guidance or ideas.</p>
</div>
</section>
<section id="tabpanel_bHGHmlrG6S_reconnecting-hosted-bot" role="tabpanel" data-tab="reconnecting-hosted-bot" aria-hidden="true" hidden="hidden">
<h3 id="enabling-auto-connection-1">Enabling auto-connection</h3>
<p><a class="xref" href="../../api/TehGM.Wolfringo.Hosting.HostedWolfClient.html">HostedWolfClient</a>, which Wolfringo.Hosting wrapper for <a class="xref" href="../../api/TehGM.Wolfringo.WolfClient.html">WolfClient</a>, includes reconnection behaviour and it's enabled by default. You don't need to perform any additional steps to turn it on.</p>
<h3 id="configuring-auto-reconnection-1">Configuring auto-reconnection</h3>
<p>Reconnection in Wolfringo.Hosting can be customized by changing properties of <a class="xref" href="../../api/TehGM.Wolfringo.Hosting.HostedWolfClientOptions.html">HostedWolfClientOptions</a>. You can do it either using appsettings.json, or configuration methods in <em>ConfigureServices</em>:</p>
<pre><code class="lang-csharp">services.AddWolfClient()
    .SetAutoReconnectAttempts(5)
    .SetAutoReconnectDelay(TimeSpan.FromSeconds(0.5));
</code></pre>
<ul>
<li><a class="xref" href="../../api/TehGM.Wolfringo.Hosting.HostedWolfClientOptions.html#TehGM_Wolfringo_Hosting_HostedWolfClientOptions_AutoReconnectAttempts">AutoReconnectAttempts</a> - number of reconnection attempts to make. If set to 0, reconnection will be disabled. If set to negative number, infinite amount of attempts will be made. <em>Defaults to 5</em>.</li>
<li><a class="xref" href="../../api/TehGM.Wolfringo.Hosting.HostedWolfClientOptions.html#TehGM_Wolfringo_Hosting_HostedWolfClientOptions_AutoReconnectDelay">AutoReconnectDelay</a> - a @System.TimeSpan that will be waited between reconnection attempts. 0 or negative values disable the wait time. <em>Defaults to half second</em>.</li>
</ul>
<h3 id="auto-reconnection-errors-1">Auto-reconnection errors</h3>
<p><a class="xref" href="../../api/TehGM.Wolfringo.Hosting.HostedWolfClient.html">HostedWolfClient</a> will automatically use configured <a class="xref" href="logging.html">logging</a> to log each error that happens when reconnecting.</p>
<p>If client makes <a class="xref" href="../../api/TehGM.Wolfringo.Hosting.HostedWolfClientOptions.html#TehGM_Wolfringo_Hosting_HostedWolfClientOptions_AutoReconnectAttempts">AutoReconnectAttempts</a> to reconnect and each attempt fails, the client will invoke <a class="xref" href="../../api/TehGM.Wolfringo.Hosting.HostedWolfClient.html#TehGM_Wolfringo_Hosting_HostedWolfClient_ErrorRaised">ErrorRaised</a> event. Its @System.UnhandledExceptionEventArgs contains @System.UnhandledExceptionEventArgs.ExceptionObject property, which will be set to an @System.AggregateException, which contains all exceptions that occured when trying to reconnect. See <a href="https://docs.microsoft.com/en-gb/dotnet/api/system.aggregateexception?view=netcore-3.0">Microsoft docs</a> to see how to handle that exception.<br>
After raising the error, the client will act accordingly to <a class="xref" href="../../api/TehGM.Wolfringo.Hosting.HostedWolfClientOptions.html#TehGM_Wolfringo_Hosting_HostedWolfClientOptions_CloseOnCriticalError">HostedWolfClientOptions.CloseOnCriticalError</a> setting - if it's set to true, the application will be terminated; otherwise, application will keep running, but bot won't reconnect unless reconnection is triggered manually.</p>
<div class="NOTE">
<h5>Note</h5>
<p><a class="xref" href="../../api/TehGM.Wolfringo.Hosting.HostedWolfClientOptions.html#TehGM_Wolfringo_Hosting_HostedWolfClientOptions_CloseOnCriticalError">HostedWolfClientOptions.CloseOnCriticalError</a> setting is used by more than just reconnection attempts - it also determines how the application will behave when initial connection fails, and when bot has failed to log in automatically.</p>
</div>
<h3 id="disabling-auto-reconnection-1">Disabling auto-reconnection</h3>
<p>To disable auto-reconnection, simply set <a class="xref" href="../../api/TehGM.Wolfringo.Hosting.HostedWolfClientOptions.html#TehGM_Wolfringo_Hosting_HostedWolfClientOptions_AutoReconnectAttempts">AutoReconnectAttempts</a> to 0. Alternatively, you can disable it in <em>ConfigureServices</em>:</p>
<pre><code class="lang-csharp">services.AddWolfClient()
    .DisableAutoReconnect();
</code></pre>
<div class="TIP">
<h5>Tip</h5>
<p>Unlike <a class="xref" href="../../api/TehGM.Wolfringo.Utilities.WolfClientReconnector.html">WolfClientReconnector</a>, <a class="xref" href="../../api/TehGM.Wolfringo.Hosting.HostedWolfClient.html">HostedWolfClient</a> is aware if the disconnection was manual - if so, it will not attempt to reconnect. Because of this, you don't need to disable reconnection if you're calling <a class="xref" href="../../api/TehGM.Wolfringo.Hosting.HostedWolfClient.html#TehGM_Wolfringo_Hosting_HostedWolfClient_DisconnectAsync_System_Threading_CancellationToken_">DisconnectAsync</a>.</p>
</div>
</section>
</div>
</article>
              
                </div>
            </main>
        </div>

        
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script>
<script type="text/javascript" src="../../styles/jquery.twbsPagination.js"></script>
<script type="text/javascript" src="../../styles/url.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script>
<script type="text/javascript" src="../../styles/docfx.js"></script>
<script type="text/javascript" src="../../styles/main.js"></script>
<script type="text/javascript">
	anchors.options.visible = 'touch';
	anchors.options.placement = 'left';
	anchors.add('h2, h3, h4, h5');
</script>
    </body>

</html>
